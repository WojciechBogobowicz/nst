
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../structure/">
      
      
        <link rel="next" href="../selectioner/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.4">
    
    
      
        <title>model.py - NST Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.240905d7.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#model" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="NST Docs" class="md-header__button md-logo" aria-label="NST Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NST Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              model.py
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/WojciechBogobowicz/nst" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="NST Docs" class="md-nav__button md-logo" aria-label="NST Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    NST Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/WojciechBogobowicz/nst" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Homepage
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../structure/" class="md-nav__link">
        Project structure
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          model.py
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        model.py
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.model" class="md-nav__link">
    src.model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer" class="md-nav__link">
    NSTImageTrainer
  </a>
  
    <nav class="md-nav" aria-label="NSTImageTrainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer.content_image" class="md-nav__link">
    content_image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer.metrics" class="md-nav__link">
    metrics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer.output_image" class="md-nav__link">
    output_image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer.style_image" class="md-nav__link">
    style_image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer.__calculate_total_variation" class="md-nav__link">
    __calculate_total_variation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer.__style_content_loss" class="md-nav__link">
    __style_content_loss()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer.from_layers_selectors" class="md-nav__link">
    from_layers_selectors()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer.model_layers_names" class="md-nav__link">
    model_layers_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer.train_step" class="md-nav__link">
    train_step()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer.training_loop" class="md-nav__link">
    training_loop()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.model.StyleContentExtractor" class="md-nav__link">
    StyleContentExtractor
  </a>
  
    <nav class="md-nav" aria-label="StyleContentExtractor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.model.StyleContentExtractor.__get_model_outputs" class="md-nav__link">
    __get_model_outputs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.StyleContentExtractor.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.StyleContentExtractor.__init_model" class="md-nav__link">
    __init_model()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.StyleContentExtractor.__preprocess_input" class="md-nav__link">
    __preprocess_input()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.StyleContentExtractor.call" class="md-nav__link">
    call()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.StyleContentExtractor.model_layers_names" class="md-nav__link">
    model_layers_names()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../selectioner/" class="md-nav__link">
        selectioner.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../vizualization/" class="md-nav__link">
        vizualization.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.model" class="md-nav__link">
    src.model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer" class="md-nav__link">
    NSTImageTrainer
  </a>
  
    <nav class="md-nav" aria-label="NSTImageTrainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer.content_image" class="md-nav__link">
    content_image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer.metrics" class="md-nav__link">
    metrics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer.output_image" class="md-nav__link">
    output_image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer.style_image" class="md-nav__link">
    style_image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer.__calculate_total_variation" class="md-nav__link">
    __calculate_total_variation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer.__style_content_loss" class="md-nav__link">
    __style_content_loss()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer.from_layers_selectors" class="md-nav__link">
    from_layers_selectors()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer.model_layers_names" class="md-nav__link">
    model_layers_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer.train_step" class="md-nav__link">
    train_step()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.NSTImageTrainer.training_loop" class="md-nav__link">
    training_loop()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.model.StyleContentExtractor" class="md-nav__link">
    StyleContentExtractor
  </a>
  
    <nav class="md-nav" aria-label="StyleContentExtractor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.model.StyleContentExtractor.__get_model_outputs" class="md-nav__link">
    __get_model_outputs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.StyleContentExtractor.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.StyleContentExtractor.__init_model" class="md-nav__link">
    __init_model()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.StyleContentExtractor.__preprocess_input" class="md-nav__link">
    __preprocess_input()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.StyleContentExtractor.call" class="md-nav__link">
    call()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.model.StyleContentExtractor.model_layers_names" class="md-nav__link">
    model_layers_names()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="model">Model</h1>
<p><code>model.py</code> is a core file that contains definition of model used in neural style training.<br />
This model is split into two classes. <a class="autorefs autorefs-internal" href="#src.model.StyleContentExtractor"><code>StyleContentExtractor</code></a> that implements forward pass of the model and <a class="autorefs autorefs-internal" href="#src.model.NSTImageTrainer"><code>NSTImageTrainer</code></a> that uses it to perform training.   </p>


<div class="doc doc-object doc-module">


<a id="src.model"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.model.NSTImageTrainer" class="doc doc-heading">
        <code>NSTImageTrainer</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="tensorflow">tf</span>.<span title="tensorflow.keras">keras</span>.<span title="tf.keras.models">models</span>.<span title="tf.keras.models.Model">Model</span></code></p>



        <details class="quote">
          <summary>Source code in <code>src/model.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NSTImageTrainer</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">style_image</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">content_image</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">style_layers</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">content_layers</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">content_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e4</span><span class="p">,</span>
        <span class="n">style_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-2</span><span class="p">,</span>
        <span class="n">total_variation_weight</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
        <span class="n">noise</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;NSTImageTrainer is able to generate image based on style and content images.</span>
<span class="sd">        It is based on pretrained vgg model, and Neural Style Transfer technique.</span>

<span class="sd">        Args:</span>
<span class="sd">            style_image (tf.Tensor): 3D Tensor represents style image</span>
<span class="sd">            content_image (tf.Tensor): 3D Tensor represents content image</span>
<span class="sd">            style_layers (list[str]): list of all vgg layers names used to calculate style.</span>
<span class="sd">                List of all avaliable layers can be returned by NSTImageTrainer.model_layers_names().</span>
<span class="sd">            content_layers (list[str]): list of all vgg layers names used to calculate content</span>
<span class="sd">                (Usualy one layer is recomended).</span>
<span class="sd">                List of all avaliable layers can be returned by NSTImageTrainer.model_layers_names()</span>
<span class="sd">            content_weight (float, optional): Weight of content loss. Defaults to 1e4.</span>
<span class="sd">            style_weight (float, optional): Weigth of style loss. Defaults to 1e-2.</span>
<span class="sd">            total_variation_weight (int, optional): Weight of total variation,</span>
<span class="sd">                increasing this should help to reduce artefacts in generated image. Defaults to 30.</span>
<span class="sd">            noise (float, optional): Amount of noise added to generated image on the beggining. Defaults to 0.25.</span>

<span class="sd">        Tips:</span>
<span class="sd">        In default paramteres role of style is much smaller than content. This aproach is suited for CPU training,</span>
<span class="sd">        because it gives good results faster. On the other hand if you use GPU,</span>
<span class="sd">        then increasing importance of style can give you more interesting images after longer traing.</span>

<span class="sd">        If you want to generate image more symilar to content image,</span>
<span class="sd">        you should use one of the ealrier layers as content layer, set small noise (or 0)</span>
<span class="sd">        and use content_weigth bigger than style weight.</span>

<span class="sd">        If you want to generate image more symilar to style image,</span>
<span class="sd">        you should use one of the ending layers as content layer, set big noise</span>
<span class="sd">        and use style_weigth bigger than content weight.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loss_tracker</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Mean</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extractor</span> <span class="o">=</span> <span class="n">StyleContentExtractor</span><span class="p">(</span><span class="n">style_layers</span><span class="p">,</span> <span class="n">content_layers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style_layers</span> <span class="o">=</span> <span class="n">style_layers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content_layers</span> <span class="o">=</span> <span class="n">content_layers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_style_layers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">style_layers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_content_layers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">content_layers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style_targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extractor</span><span class="p">(</span><span class="n">style_image</span><span class="p">)[</span><span class="s2">&quot;style&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content_targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extractor</span><span class="p">(</span><span class="n">content_image</span><span class="p">)[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>
        <span class="n">noise</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">content_image</span><span class="p">),</span> <span class="o">-</span><span class="n">noise</span><span class="p">,</span> <span class="n">noise</span><span class="p">)</span>
        <span class="n">output_image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">content_image</span><span class="p">,</span> <span class="n">noise</span><span class="p">)</span>
        <span class="n">output_image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">clip_by_value</span><span class="p">(</span>
            <span class="n">output_image</span><span class="p">,</span> <span class="n">clip_value_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">clip_value_max</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__output_image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">output_image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style_weight</span> <span class="o">=</span> <span class="n">style_weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content_weight</span> <span class="o">=</span> <span class="n">content_weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_variation_weight</span> <span class="o">=</span> <span class="n">total_variation_weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__style_image</span> <span class="o">=</span> <span class="n">style_image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__content_image</span> <span class="o">=</span> <span class="n">content_image</span>

    <span class="k">def</span> <span class="nf">training_loop</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">steps_per_epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">callbacks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Train output image. After every epoch callbacks are called.</span>

<span class="sd">        Args:</span>
<span class="sd">            epochs (int): Nuber of epoch in training.</span>
<span class="sd">            steps (int): Training steps in every epoch. After each step gradiends are applied to image.</span>
<span class="sd">            callbacks (list[Callable[[],]], optional): List of callable objects,</span>
<span class="sd">            that are called on the end of every trainer training.</span>
<span class="sd">            They cannot take any parameters. If you need to use function with parameters,</span>
<span class="sd">            wrap it like in exapmle below. Defaults to None.</span>

<span class="sd">        Callback wrap examples:</span>

<span class="sd">        def callback_without_arg():</span>
<span class="sd">            callback(global_arg1, global_arg2)</span>

<span class="sd">        or</span>

<span class="sd">        class CallbackObj:</span>
<span class="sd">            def __init__(arg1, arg2, callback):</span>
<span class="sd">                self.arg1 = arg1</span>
<span class="sd">                self.arg2 = arg2</span>
<span class="sd">                self.callback = callback</span>

<span class="sd">            def __call__(self):</span>
<span class="sd">                self.callback(self.arg1, self.arg2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">epoch_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">epochs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Epoch </span><span class="si">{</span><span class="n">epoch_num</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">steps_per_epoch</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">train_step</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">callbacks</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="n">callbacks</span><span class="p">:</span>
                    <span class="n">callback</span><span class="p">()</span>

    <span class="nd">@tf</span><span class="o">.</span><span class="n">function</span><span class="p">()</span>
    <span class="nd">@tf</span><span class="o">.</span><span class="n">autograph</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">do_not_convert</span>
    <span class="k">def</span> <span class="nf">train_step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform the actual training step.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">GradientTape</span><span class="p">()</span> <span class="k">as</span> <span class="n">tape</span><span class="p">:</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extractor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__output_image</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__style_content_loss</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__calculate_total_variation</span><span class="p">()</span>

        <span class="n">grad</span> <span class="o">=</span> <span class="n">tape</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__output_image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">apply_gradients</span><span class="p">([(</span><span class="n">grad</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__output_image</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__output_image</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">tf_utils</span><span class="o">.</span><span class="n">clip_0_1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__output_image</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__style_content_loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the style and content loss based on output from StyleContentExtractor.</span>

<span class="sd">        Args:</span>
<span class="sd">            outputs (dict[str, dict]): output from StyleContentExtractor call.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Total weighted style and content loss.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">style_outputs</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;style&quot;</span><span class="p">]</span>
        <span class="n">content_outputs</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>
        <span class="n">style_loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">add_n</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">((</span><span class="n">style_outputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">style_targets</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">style_outputs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">style_loss</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">style_weight</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_style_layers</span>

        <span class="n">content_loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">add_n</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">content_outputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_targets</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">content_outputs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">content_loss</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_weight</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_content_layers</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">style_loss</span> <span class="o">+</span> <span class="n">content_loss</span>
        <span class="k">return</span> <span class="n">loss</span>

    <span class="k">def</span> <span class="nf">__calculate_total_variation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the total variation of the output image.</span>

<span class="sd">        Returns:</span>
<span class="sd">            [float]: The total, weighted, variation of output image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_variation_weight</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">total_variation</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__output_image</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of tracked metrics. In this case only loss is tracked,</span>
<span class="sd">            but list is returned because of compatibility with tensorflow.</span>

<span class="sd">        Returns:</span>
<span class="sd">            [list[tf.keras.metrics.Mean]]: tf.keras.metrics.Mean object wrapped in the list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">loss_tracker</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">output_image</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Outputs the image representation of generated image tensor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            PIL.Image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">tf_utils</span><span class="o">.</span><span class="n">tensor_to_image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__output_image</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">style_image</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Outputs the image representation of style image tensor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            PIL.Image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">tf_utils</span><span class="o">.</span><span class="n">tensor_to_image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__style_image</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">content_image</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Outputs the image representation of content image tensor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            PIL.Image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">tf_utils</span><span class="o">.</span><span class="n">tensor_to_image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__content_image</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">model_layers_names</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of all model layers names.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">layer</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">StyleContentExtractor</span><span class="o">.</span><span class="n">base_model</span><span class="o">.</span><span class="n">layers</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_layers_selectors</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">style_image</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">content_image</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">style_layers_selector</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">content_layers_selector</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">trainer_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">total_variation_weight</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>
        <span class="n">style_layers_selector_kw</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span>
        <span class="n">content_layers_selector_kw</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a NSTImageTrainer from a style_layers_selector and content_layler_selector functions.</span>

<span class="sd">        Args:</span>
<span class="sd">            style_image (tf.Tensor): 3D Tensor represents style image.</span>
<span class="sd">            content_image (tf.Tensor): 3D Tensor represents content image.</span>
<span class="sd">            style_layers_selector (Callable[[list[str]], list[str]]): Function, that takes as arugment</span>
<span class="sd">                list of all convolutional layers names and return subset of them. Returned list will be used</span>
<span class="sd">                as style layers in currently created NSTImageTrainer.</span>
<span class="sd">            content_layers_selector (Callable[[list[str]], list[str]]): Function, that takes as arugment</span>
<span class="sd">                list of all convolutional layers names and return subset of them. Returned list will be used</span>
<span class="sd">                as content layers in currently created NSTImageTrainer.</span>
<span class="sd">            trainer_kw (dict, optional): Keyword arguments to create NSTImageTrainer.</span>
<span class="sd">                Defaults to {&quot;total_variation_weight&quot;: 30}.</span>
<span class="sd">            style_layers_selector_kw ([dict], optional): Keywords arguments of style_layers_selector.</span>
<span class="sd">                Defaults to dict().</span>
<span class="sd">            content_layers_selector_kw ([dict], optional): Keywords arguments of content_layers_selector.</span>
<span class="sd">                Defaults to dict().</span>

<span class="sd">        Returns:</span>
<span class="sd">            NSTImageTrainer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">layers</span> <span class="o">=</span> <span class="n">NSTImageTrainer</span><span class="o">.</span><span class="n">model_layers_names</span><span class="p">()</span>
        <span class="n">conv_layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">layers</span> <span class="k">if</span> <span class="s2">&quot;conv&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">]</span>

        <span class="n">style_layers</span> <span class="o">=</span> <span class="n">style_layers_selector</span><span class="p">(</span><span class="n">conv_layers</span><span class="p">,</span> <span class="o">**</span><span class="n">style_layers_selector_kw</span><span class="p">)</span>
        <span class="n">content_layers</span> <span class="o">=</span> <span class="n">content_layers_selector</span><span class="p">(</span>
            <span class="n">conv_layers</span><span class="p">,</span> <span class="o">**</span><span class="n">content_layers_selector_kw</span>
        <span class="p">)</span>

        <span class="n">trainer</span> <span class="o">=</span> <span class="n">NSTImageTrainer</span><span class="p">(</span>
            <span class="n">style_image</span><span class="p">,</span> <span class="n">content_image</span><span class="p">,</span> <span class="n">style_layers</span><span class="p">,</span> <span class="n">content_layers</span><span class="p">,</span> <span class="o">**</span><span class="n">trainer_kw</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">trainer</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="src.model.NSTImageTrainer.content_image" class="doc doc-heading">
<code class="highlight language-python"><span class="n">content_image</span><span class="p">:</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Outputs the image representation of content image tensor.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>PIL.<span title="PIL.Image">Image</span></code>
          </td>
          <td><p>PIL.Image</p></td>
        </tr>
    </tbody>
  </table>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="src.model.NSTImageTrainer.metrics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">metrics</span><span class="p">:</span> <span class="nb">list</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return a list of tracked metrics. In this case only loss is tracked,
    but list is returned because of compatibility with tensorflow.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list</code>
          </td>
          <td><p>[list[tf.keras.metrics.Mean]]: tf.keras.metrics.Mean object wrapped in the list.</p></td>
        </tr>
    </tbody>
  </table>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="src.model.NSTImageTrainer.output_image" class="doc doc-heading">
<code class="highlight language-python"><span class="n">output_image</span><span class="p">:</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Outputs the image representation of generated image tensor.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>PIL.<span title="PIL.Image">Image</span></code>
          </td>
          <td><p>PIL.Image</p></td>
        </tr>
    </tbody>
  </table>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="src.model.NSTImageTrainer.style_image" class="doc doc-heading">
<code class="highlight language-python"><span class="n">style_image</span><span class="p">:</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Outputs the image representation of style image tensor.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>PIL.<span title="PIL.Image">Image</span></code>
          </td>
          <td><p>PIL.Image</p></td>
        </tr>
    </tbody>
  </table>
  </div>

</div>



<div class="doc doc-object doc-function">



<h3 id="src.model.NSTImageTrainer.__calculate_total_variation" class="doc doc-heading">
<code class="highlight language-python"><span class="n">__calculate_total_variation</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculates the total variation of the output image.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td><p>[float]: The total, weighted, variation of output image.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__calculate_total_variation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the total variation of the output image.</span>

<span class="sd">    Returns:</span>
<span class="sd">        [float]: The total, weighted, variation of output image.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_variation_weight</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">total_variation</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__output_image</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.model.NSTImageTrainer.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">style_image</span><span class="p">,</span> <span class="n">content_image</span><span class="p">,</span> <span class="n">style_layers</span><span class="p">,</span> <span class="n">content_layers</span><span class="p">,</span> <span class="n">content_weight</span><span class="o">=</span><span class="mf">10000.0</span><span class="p">,</span> <span class="n">style_weight</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">total_variation_weight</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>NSTImageTrainer is able to generate image based on style and content images.
It is based on pretrained vgg model, and Neural Style Transfer technique.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>style_image</code></td>
          <td>
                <code><span title="tensorflow">tf</span>.<span title="tensorflow.Tensor">Tensor</span></code>
          </td>
          <td><p>3D Tensor represents style image</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>content_image</code></td>
          <td>
                <code><span title="tensorflow">tf</span>.<span title="tensorflow.Tensor">Tensor</span></code>
          </td>
          <td><p>3D Tensor represents content image</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>style_layers</code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td><p>list of all vgg layers names used to calculate style.
List of all avaliable layers can be returned by NSTImageTrainer.model_layers_names().</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>content_layers</code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td><p>list of all vgg layers names used to calculate content
(Usualy one layer is recomended).
List of all avaliable layers can be returned by NSTImageTrainer.model_layers_names()</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>content_weight</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Weight of content loss. Defaults to 1e4.</p></td>
          <td>
                <code>10000.0</code>
          </td>
        </tr>
        <tr>
          <td><code>style_weight</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Weigth of style loss. Defaults to 1e-2.</p></td>
          <td>
                <code>0.01</code>
          </td>
        </tr>
        <tr>
          <td><code>total_variation_weight</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Weight of total variation,
increasing this should help to reduce artefacts in generated image. Defaults to 30.</p></td>
          <td>
                <code>30</code>
          </td>
        </tr>
        <tr>
          <td><code>noise</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Amount of noise added to generated image on the beggining. Defaults to 0.25.</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Tips:
In default paramteres role of style is much smaller than content. This aproach is suited for CPU training,
because it gives good results faster. On the other hand if you use GPU,
then increasing importance of style can give you more interesting images after longer traing.</p>
<p>If you want to generate image more symilar to content image,
you should use one of the ealrier layers as content layer, set small noise (or 0)
and use content_weigth bigger than style weight.</p>
<p>If you want to generate image more symilar to style image,
you should use one of the ending layers as content layer, set big noise
and use style_weigth bigger than content weight.</p>

      <details class="quote">
        <summary>Source code in <code>src/model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">style_image</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">content_image</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">style_layers</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">content_layers</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">content_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e4</span><span class="p">,</span>
    <span class="n">style_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-2</span><span class="p">,</span>
    <span class="n">total_variation_weight</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">noise</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;NSTImageTrainer is able to generate image based on style and content images.</span>
<span class="sd">    It is based on pretrained vgg model, and Neural Style Transfer technique.</span>

<span class="sd">    Args:</span>
<span class="sd">        style_image (tf.Tensor): 3D Tensor represents style image</span>
<span class="sd">        content_image (tf.Tensor): 3D Tensor represents content image</span>
<span class="sd">        style_layers (list[str]): list of all vgg layers names used to calculate style.</span>
<span class="sd">            List of all avaliable layers can be returned by NSTImageTrainer.model_layers_names().</span>
<span class="sd">        content_layers (list[str]): list of all vgg layers names used to calculate content</span>
<span class="sd">            (Usualy one layer is recomended).</span>
<span class="sd">            List of all avaliable layers can be returned by NSTImageTrainer.model_layers_names()</span>
<span class="sd">        content_weight (float, optional): Weight of content loss. Defaults to 1e4.</span>
<span class="sd">        style_weight (float, optional): Weigth of style loss. Defaults to 1e-2.</span>
<span class="sd">        total_variation_weight (int, optional): Weight of total variation,</span>
<span class="sd">            increasing this should help to reduce artefacts in generated image. Defaults to 30.</span>
<span class="sd">        noise (float, optional): Amount of noise added to generated image on the beggining. Defaults to 0.25.</span>

<span class="sd">    Tips:</span>
<span class="sd">    In default paramteres role of style is much smaller than content. This aproach is suited for CPU training,</span>
<span class="sd">    because it gives good results faster. On the other hand if you use GPU,</span>
<span class="sd">    then increasing importance of style can give you more interesting images after longer traing.</span>

<span class="sd">    If you want to generate image more symilar to content image,</span>
<span class="sd">    you should use one of the ealrier layers as content layer, set small noise (or 0)</span>
<span class="sd">    and use content_weigth bigger than style weight.</span>

<span class="sd">    If you want to generate image more symilar to style image,</span>
<span class="sd">    you should use one of the ending layers as content layer, set big noise</span>
<span class="sd">    and use style_weigth bigger than content weight.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">loss_tracker</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Mean</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">extractor</span> <span class="o">=</span> <span class="n">StyleContentExtractor</span><span class="p">(</span><span class="n">style_layers</span><span class="p">,</span> <span class="n">content_layers</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">style_layers</span> <span class="o">=</span> <span class="n">style_layers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">content_layers</span> <span class="o">=</span> <span class="n">content_layers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">num_style_layers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">style_layers</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">num_content_layers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">content_layers</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">style_targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extractor</span><span class="p">(</span><span class="n">style_image</span><span class="p">)[</span><span class="s2">&quot;style&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">content_targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extractor</span><span class="p">(</span><span class="n">content_image</span><span class="p">)[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">content_image</span><span class="p">),</span> <span class="o">-</span><span class="n">noise</span><span class="p">,</span> <span class="n">noise</span><span class="p">)</span>
    <span class="n">output_image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">content_image</span><span class="p">,</span> <span class="n">noise</span><span class="p">)</span>
    <span class="n">output_image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">clip_by_value</span><span class="p">(</span>
        <span class="n">output_image</span><span class="p">,</span> <span class="n">clip_value_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">clip_value_max</span><span class="o">=</span><span class="mf">1.0</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__output_image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">output_image</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">style_weight</span> <span class="o">=</span> <span class="n">style_weight</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">content_weight</span> <span class="o">=</span> <span class="n">content_weight</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_variation_weight</span> <span class="o">=</span> <span class="n">total_variation_weight</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__style_image</span> <span class="o">=</span> <span class="n">style_image</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__content_image</span> <span class="o">=</span> <span class="n">content_image</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.model.NSTImageTrainer.__style_content_loss" class="doc doc-heading">
<code class="highlight language-python"><span class="n">__style_content_loss</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Compute the style and content loss based on output from StyleContentExtractor.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>outputs</code></td>
          <td>
                <code>dict[str, dict]</code>
          </td>
          <td><p>output from StyleContentExtractor call.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>float</code></td>          <td>
                <code>float</code>
          </td>
          <td><p>Total weighted style and content loss.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__style_content_loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the style and content loss based on output from StyleContentExtractor.</span>

<span class="sd">    Args:</span>
<span class="sd">        outputs (dict[str, dict]): output from StyleContentExtractor call.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Total weighted style and content loss.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">style_outputs</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;style&quot;</span><span class="p">]</span>
    <span class="n">content_outputs</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>
    <span class="n">style_loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">add_n</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">((</span><span class="n">style_outputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">style_targets</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">style_outputs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">style_loss</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">style_weight</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_style_layers</span>

    <span class="n">content_loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">add_n</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span>
                <span class="p">(</span><span class="n">content_outputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_targets</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">content_outputs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">content_loss</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_weight</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_content_layers</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">style_loss</span> <span class="o">+</span> <span class="n">content_loss</span>
    <span class="k">return</span> <span class="n">loss</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.model.NSTImageTrainer.from_layers_selectors" class="doc doc-heading">
<code class="highlight language-python"><span class="n">from_layers_selectors</span><span class="p">(</span><span class="n">style_image</span><span class="p">,</span> <span class="n">content_image</span><span class="p">,</span> <span class="n">style_layers_selector</span><span class="p">,</span> <span class="n">content_layers_selector</span><span class="p">,</span> <span class="n">trainer_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">total_variation_weight</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span> <span class="n">style_layers_selector_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">content_layers_selector_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">())</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Create a NSTImageTrainer from a style_layers_selector and content_layler_selector functions.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>style_image</code></td>
          <td>
                <code><span title="tensorflow">tf</span>.<span title="tensorflow.Tensor">Tensor</span></code>
          </td>
          <td><p>3D Tensor represents style image.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>content_image</code></td>
          <td>
                <code><span title="tensorflow">tf</span>.<span title="tensorflow.Tensor">Tensor</span></code>
          </td>
          <td><p>3D Tensor represents content image.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>style_layers_selector</code></td>
          <td>
                <code><span title="typing.Callable">Callable</span>[[list[str]], list[str]]</code>
          </td>
          <td><p>Function, that takes as arugment
list of all convolutional layers names and return subset of them. Returned list will be used
as style layers in currently created NSTImageTrainer.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>content_layers_selector</code></td>
          <td>
                <code><span title="typing.Callable">Callable</span>[[list[str]], list[str]]</code>
          </td>
          <td><p>Function, that takes as arugment
list of all convolutional layers names and return subset of them. Returned list will be used
as content layers in currently created NSTImageTrainer.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>trainer_kw</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Keyword arguments to create NSTImageTrainer.
Defaults to {"total_variation_weight": 30}.</p></td>
          <td>
                <code>dict(total_variation_weight=30)</code>
          </td>
        </tr>
        <tr>
          <td><code>style_layers_selector_kw</code></td>
          <td>
                <code>[dict]</code>
          </td>
          <td><p>Keywords arguments of style_layers_selector.
Defaults to dict().</p></td>
          <td>
                <code>dict()</code>
          </td>
        </tr>
        <tr>
          <td><code>content_layers_selector_kw</code></td>
          <td>
                <code>[dict]</code>
          </td>
          <td><p>Keywords arguments of content_layers_selector.
Defaults to dict().</p></td>
          <td>
                <code>dict()</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td><p>NSTImageTrainer</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_layers_selectors</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">style_image</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">content_image</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">style_layers_selector</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
    <span class="n">content_layers_selector</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
    <span class="n">trainer_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">total_variation_weight</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>
    <span class="n">style_layers_selector_kw</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span>
    <span class="n">content_layers_selector_kw</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a NSTImageTrainer from a style_layers_selector and content_layler_selector functions.</span>

<span class="sd">    Args:</span>
<span class="sd">        style_image (tf.Tensor): 3D Tensor represents style image.</span>
<span class="sd">        content_image (tf.Tensor): 3D Tensor represents content image.</span>
<span class="sd">        style_layers_selector (Callable[[list[str]], list[str]]): Function, that takes as arugment</span>
<span class="sd">            list of all convolutional layers names and return subset of them. Returned list will be used</span>
<span class="sd">            as style layers in currently created NSTImageTrainer.</span>
<span class="sd">        content_layers_selector (Callable[[list[str]], list[str]]): Function, that takes as arugment</span>
<span class="sd">            list of all convolutional layers names and return subset of them. Returned list will be used</span>
<span class="sd">            as content layers in currently created NSTImageTrainer.</span>
<span class="sd">        trainer_kw (dict, optional): Keyword arguments to create NSTImageTrainer.</span>
<span class="sd">            Defaults to {&quot;total_variation_weight&quot;: 30}.</span>
<span class="sd">        style_layers_selector_kw ([dict], optional): Keywords arguments of style_layers_selector.</span>
<span class="sd">            Defaults to dict().</span>
<span class="sd">        content_layers_selector_kw ([dict], optional): Keywords arguments of content_layers_selector.</span>
<span class="sd">            Defaults to dict().</span>

<span class="sd">    Returns:</span>
<span class="sd">        NSTImageTrainer</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">layers</span> <span class="o">=</span> <span class="n">NSTImageTrainer</span><span class="o">.</span><span class="n">model_layers_names</span><span class="p">()</span>
    <span class="n">conv_layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">layers</span> <span class="k">if</span> <span class="s2">&quot;conv&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">]</span>

    <span class="n">style_layers</span> <span class="o">=</span> <span class="n">style_layers_selector</span><span class="p">(</span><span class="n">conv_layers</span><span class="p">,</span> <span class="o">**</span><span class="n">style_layers_selector_kw</span><span class="p">)</span>
    <span class="n">content_layers</span> <span class="o">=</span> <span class="n">content_layers_selector</span><span class="p">(</span>
        <span class="n">conv_layers</span><span class="p">,</span> <span class="o">**</span><span class="n">content_layers_selector_kw</span>
    <span class="p">)</span>

    <span class="n">trainer</span> <span class="o">=</span> <span class="n">NSTImageTrainer</span><span class="p">(</span>
        <span class="n">style_image</span><span class="p">,</span> <span class="n">content_image</span><span class="p">,</span> <span class="n">style_layers</span><span class="p">,</span> <span class="n">content_layers</span><span class="p">,</span> <span class="o">**</span><span class="n">trainer_kw</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">trainer</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.model.NSTImageTrainer.model_layers_names" class="doc doc-heading">
<code class="highlight language-python"><span class="n">model_layers_names</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns a list of all model layers names.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list[str]</code>
          </td>
          <td><p>list[str]</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">model_layers_names</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a list of all model layers names.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[str]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">layer</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">StyleContentExtractor</span><span class="o">.</span><span class="n">base_model</span><span class="o">.</span><span class="n">layers</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.model.NSTImageTrainer.train_step" class="doc doc-heading">
<code class="highlight language-python"><span class="n">train_step</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Perform the actual training step.</p>

      <details class="quote">
        <summary>Source code in <code>src/model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tf</span><span class="o">.</span><span class="n">function</span><span class="p">()</span>
<span class="nd">@tf</span><span class="o">.</span><span class="n">autograph</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">do_not_convert</span>
<span class="k">def</span> <span class="nf">train_step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform the actual training step.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">GradientTape</span><span class="p">()</span> <span class="k">as</span> <span class="n">tape</span><span class="p">:</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extractor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__output_image</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__style_content_loss</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__calculate_total_variation</span><span class="p">()</span>

    <span class="n">grad</span> <span class="o">=</span> <span class="n">tape</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__output_image</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">apply_gradients</span><span class="p">([(</span><span class="n">grad</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__output_image</span><span class="p">)])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__output_image</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">tf_utils</span><span class="o">.</span><span class="n">clip_0_1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__output_image</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.model.NSTImageTrainer.training_loop" class="doc doc-heading">
<code class="highlight language-python"><span class="n">training_loop</span><span class="p">(</span><span class="n">steps_per_epoch</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Train output image. After every epoch callbacks are called.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>epochs</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Nuber of epoch in training.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>steps</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Training steps in every epoch. After each step gradiends are applied to image.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>callbacks</code></td>
          <td>
                <code>list[<span title="typing.Callable">Callable</span>[[]]]</code>
          </td>
          <td><p>List of callable objects,</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Callback wrap examples:</p>
<p>def callback_without_arg():
    callback(global_arg1, global_arg2)</p>
<p>or</p>

<details class="class-callbackobj">
  <summary>class CallbackObj</summary>
  <p>def <strong>init</strong>(arg1, arg2, callback):
    self.arg1 = arg1
    self.arg2 = arg2
    self.callback = callback</p>
<p>def <strong>call</strong>(self):
    self.callback(self.arg1, self.arg2)</p>
</details>
      <details class="quote">
        <summary>Source code in <code>src/model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">training_loop</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">steps_per_epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Train output image. After every epoch callbacks are called.</span>

<span class="sd">    Args:</span>
<span class="sd">        epochs (int): Nuber of epoch in training.</span>
<span class="sd">        steps (int): Training steps in every epoch. After each step gradiends are applied to image.</span>
<span class="sd">        callbacks (list[Callable[[],]], optional): List of callable objects,</span>
<span class="sd">        that are called on the end of every trainer training.</span>
<span class="sd">        They cannot take any parameters. If you need to use function with parameters,</span>
<span class="sd">        wrap it like in exapmle below. Defaults to None.</span>

<span class="sd">    Callback wrap examples:</span>

<span class="sd">    def callback_without_arg():</span>
<span class="sd">        callback(global_arg1, global_arg2)</span>

<span class="sd">    or</span>

<span class="sd">    class CallbackObj:</span>
<span class="sd">        def __init__(arg1, arg2, callback):</span>
<span class="sd">            self.arg1 = arg1</span>
<span class="sd">            self.arg2 = arg2</span>
<span class="sd">            self.callback = callback</span>

<span class="sd">        def __call__(self):</span>
<span class="sd">            self.callback(self.arg1, self.arg2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">epoch_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">epochs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Epoch </span><span class="si">{</span><span class="n">epoch_num</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">steps_per_epoch</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">train_step</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">callbacks</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="n">callbacks</span><span class="p">:</span>
                <span class="n">callback</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.model.StyleContentExtractor" class="doc doc-heading">
        <code>StyleContentExtractor</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="tensorflow">tf</span>.<span title="tensorflow.keras">keras</span>.<span title="tf.keras.models">models</span>.<span title="tf.keras.models.Model">Model</span></code></p>



        <details class="quote">
          <summary>Source code in <code>src/model.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">StyleContentExtractor</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">base_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">applications</span><span class="o">.</span><span class="n">VGG19</span><span class="p">(</span><span class="n">include_top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s2">&quot;imagenet&quot;</span><span class="p">)</span>
    <span class="n">base_model</span><span class="o">.</span><span class="n">trainable</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">style_layers</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">content_layers</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;StyleContentExtractor implements forward pass of NST image training. It is core of NSTImageTrainer.</span>
<span class="sd">            All created StyleContentExtractors share the same VGG19 model as base, to save memory.</span>

<span class="sd">        Args:</span>
<span class="sd">            style_layers (list[str]): list of all vgg layers names used to calculate style.</span>
<span class="sd">                List of all avaliable layers can be returnrd by NSTImageTrainer.model_layers_names()</span>
<span class="sd">            content_layers (list[str]): list of all vgg layers names used to calculate content</span>
<span class="sd">                (Usualy one layer is recomended).</span>
<span class="sd">                List of all avaliable layers can be returned by NSTImageTrainer.model_layers_names()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__init_model</span><span class="p">(</span><span class="n">style_layers</span> <span class="o">+</span> <span class="n">content_layers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style_layers</span> <span class="o">=</span> <span class="n">style_layers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content_layers</span> <span class="o">=</span> <span class="n">content_layers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_style_layers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">style_layers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">input_max_value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement forward pass of the model.</span>

<span class="sd">        Args:</span>
<span class="sd">            inputs (tf.Tensor): Tensor with image/images batch to process</span>
<span class="sd">            input_max_value (int, optional): Maximal value in input image. Defaults to 1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            [dict[str, dict]]: dict with two keys: &quot;content&quot; and &quot;style&quot;,</span>
<span class="sd">            value of each key contains neasted dict with layer name as key</span>
<span class="sd">            and corespoding model output as value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content_outputs</span><span class="p">,</span> <span class="n">style_outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_model_outputs</span><span class="p">(</span>
            <span class="n">inputs</span><span class="p">,</span> <span class="n">input_max_value</span>
        <span class="p">)</span>
        <span class="n">content_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content_layers</span><span class="p">,</span> <span class="n">content_outputs</span><span class="p">))</span>
        <span class="n">style_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">style_layers</span><span class="p">,</span> <span class="n">style_outputs</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">content_dict</span><span class="p">,</span> <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="n">style_dict</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize vgg model with outputs specified in layers_names.</span>

<span class="sd">        Args:</span>
<span class="sd">            layer_names (list[str]): Both, style and content layers used to define output layers of model.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tf.keras.Model: Vgg19 model with multiple outputs on diffrent layers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">base_model</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">output</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">layer_names</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">base_model</span><span class="o">.</span><span class="n">input</span><span class="p">],</span> <span class="n">outputs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_model_outputs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">input_max_value</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Runs the model and returns the content and style matrices.</span>

<span class="sd">        Args:</span>
<span class="sd">            inputs (tf.Tensor): Tensor with image/images batch to process</span>
<span class="sd">            input_max_value (int, optional): Maximal value in input image. Defaults to 1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            [tuple[list[tf.Tensor], list[tf.Tensor]]]: Two lists with content and style model outputs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">processed_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__preprocess_input</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">input_max_value</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">processed_input</span><span class="p">)</span>
        <span class="n">content_outputs</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_style_layers</span> <span class="p">:]</span>
        <span class="n">style_outputs</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">tf_utils</span><span class="o">.</span><span class="n">gram_matrix</span><span class="p">,</span> <span class="n">outputs</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_style_layers</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">content_outputs</span><span class="p">,</span> <span class="n">style_outputs</span>

    <span class="k">def</span> <span class="nf">__preprocess_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">input_max_value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Preprocess the input to meet vgg requirements.</span>

<span class="sd">        Args:</span>
<span class="sd">            inputs (tf.Tensor): Tensor with image/images batch to process.</span>
<span class="sd">            input_max_value (int, optional): Maximal value in input image. Defaults to 1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tf.Tensor: Preprocessed image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># self.__assert_max_value_not_exceeded(inputs, input_max_value)</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span> <span class="o">*</span> <span class="p">(</span><span class="mf">255.0</span> <span class="o">/</span> <span class="n">input_max_value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">applications</span><span class="o">.</span><span class="n">vgg19</span><span class="o">.</span><span class="n">preprocess_input</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

    <span class="c1"># def __assert_max_value_not_exceeded(self, inputs, input_max_value):</span>
    <span class="c1">#     biggest_input = tf.reduce_max(inputs)</span>
    <span class="c1">#     if biggest_input &gt; input_max_value:</span>
    <span class="c1">#         raise ValueError(</span>
    <span class="c1">#             f&quot;Given tensor have values grater than {input_max_value = }, {biggest_input = }&quot;</span>
    <span class="c1">#         )</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">model_layers_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of vgg19 layer names.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">layer</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">base_model</span><span class="o">.</span><span class="n">layers</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="src.model.StyleContentExtractor.__get_model_outputs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">__get_model_outputs</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">input_max_value</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Runs the model and returns the content and style matrices.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>inputs</code></td>
          <td>
                <code><span title="tensorflow">tf</span>.<span title="tensorflow.Tensor">Tensor</span></code>
          </td>
          <td><p>Tensor with image/images batch to process</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>input_max_value</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Maximal value in input image. Defaults to 1.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple[list[<span title="tensorflow">tf</span>.<span title="tensorflow.Tensor">Tensor</span>], list[<span title="tensorflow">tf</span>.<span title="tensorflow.Tensor">Tensor</span>]]</code>
          </td>
          <td><p>[tuple[list[tf.Tensor], list[tf.Tensor]]]: Two lists with content and style model outputs.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__get_model_outputs</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">input_max_value</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs the model and returns the content and style matrices.</span>

<span class="sd">    Args:</span>
<span class="sd">        inputs (tf.Tensor): Tensor with image/images batch to process</span>
<span class="sd">        input_max_value (int, optional): Maximal value in input image. Defaults to 1.</span>

<span class="sd">    Returns:</span>
<span class="sd">        [tuple[list[tf.Tensor], list[tf.Tensor]]]: Two lists with content and style model outputs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">processed_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__preprocess_input</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">input_max_value</span><span class="p">)</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">processed_input</span><span class="p">)</span>
    <span class="n">content_outputs</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_style_layers</span> <span class="p">:]</span>
    <span class="n">style_outputs</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">tf_utils</span><span class="o">.</span><span class="n">gram_matrix</span><span class="p">,</span> <span class="n">outputs</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_style_layers</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">content_outputs</span><span class="p">,</span> <span class="n">style_outputs</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.model.StyleContentExtractor.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">style_layers</span><span class="p">,</span> <span class="n">content_layers</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>StyleContentExtractor implements forward pass of NST image training. It is core of NSTImageTrainer.
    All created StyleContentExtractors share the same VGG19 model as base, to save memory.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>style_layers</code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td><p>list of all vgg layers names used to calculate style.
List of all avaliable layers can be returnrd by NSTImageTrainer.model_layers_names()</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>content_layers</code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td><p>list of all vgg layers names used to calculate content
(Usualy one layer is recomended).
List of all avaliable layers can be returned by NSTImageTrainer.model_layers_names()</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">style_layers</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">content_layers</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;StyleContentExtractor implements forward pass of NST image training. It is core of NSTImageTrainer.</span>
<span class="sd">        All created StyleContentExtractors share the same VGG19 model as base, to save memory.</span>

<span class="sd">    Args:</span>
<span class="sd">        style_layers (list[str]): list of all vgg layers names used to calculate style.</span>
<span class="sd">            List of all avaliable layers can be returnrd by NSTImageTrainer.model_layers_names()</span>
<span class="sd">        content_layers (list[str]): list of all vgg layers names used to calculate content</span>
<span class="sd">            (Usualy one layer is recomended).</span>
<span class="sd">            List of all avaliable layers can be returned by NSTImageTrainer.model_layers_names()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__init_model</span><span class="p">(</span><span class="n">style_layers</span> <span class="o">+</span> <span class="n">content_layers</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">style_layers</span> <span class="o">=</span> <span class="n">style_layers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">content_layers</span> <span class="o">=</span> <span class="n">content_layers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">num_style_layers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">style_layers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.model.StyleContentExtractor.__init_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">__init_model</span><span class="p">(</span><span class="n">layer_names</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize vgg model with outputs specified in layers_names.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>layer_names</code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td><p>Both, style and content layers used to define output layers of model.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td><p>tf.keras.Model: Vgg19 model with multiple outputs on diffrent layers.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__init_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize vgg model with outputs specified in layers_names.</span>

<span class="sd">    Args:</span>
<span class="sd">        layer_names (list[str]): Both, style and content layers used to define output layers of model.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tf.keras.Model: Vgg19 model with multiple outputs on diffrent layers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">base_model</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">output</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">layer_names</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">base_model</span><span class="o">.</span><span class="n">input</span><span class="p">],</span> <span class="n">outputs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.model.StyleContentExtractor.__preprocess_input" class="doc doc-heading">
<code class="highlight language-python"><span class="n">__preprocess_input</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">input_max_value</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Preprocess the input to meet vgg requirements.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>inputs</code></td>
          <td>
                <code><span title="tensorflow">tf</span>.<span title="tensorflow.Tensor">Tensor</span></code>
          </td>
          <td><p>Tensor with image/images batch to process.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>input_max_value</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Maximal value in input image. Defaults to 1.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="tensorflow">tf</span>.<span title="tensorflow.Tensor">Tensor</span></code>
          </td>
          <td><p>tf.Tensor: Preprocessed image</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__preprocess_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">input_max_value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preprocess the input to meet vgg requirements.</span>

<span class="sd">    Args:</span>
<span class="sd">        inputs (tf.Tensor): Tensor with image/images batch to process.</span>
<span class="sd">        input_max_value (int, optional): Maximal value in input image. Defaults to 1.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tf.Tensor: Preprocessed image</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># self.__assert_max_value_not_exceeded(inputs, input_max_value)</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span> <span class="o">*</span> <span class="p">(</span><span class="mf">255.0</span> <span class="o">/</span> <span class="n">input_max_value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">applications</span><span class="o">.</span><span class="n">vgg19</span><span class="o">.</span><span class="n">preprocess_input</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.model.StyleContentExtractor.call" class="doc doc-heading">
<code class="highlight language-python"><span class="n">call</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">input_max_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Implement forward pass of the model.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>inputs</code></td>
          <td>
                <code><span title="tensorflow">tf</span>.<span title="tensorflow.Tensor">Tensor</span></code>
          </td>
          <td><p>Tensor with image/images batch to process</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>input_max_value</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Maximal value in input image. Defaults to 1.</p></td>
          <td>
                <code>1</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dict[str, dict]</code>
          </td>
          <td><p>[dict[str, dict]]: dict with two keys: "content" and "style",</p></td>
        </tr>
        <tr>
          <td>
                <code>dict[str, dict]</code>
          </td>
          <td><p>value of each key contains neasted dict with layer name as key</p></td>
        </tr>
        <tr>
          <td>
                <code>dict[str, dict]</code>
          </td>
          <td><p>and corespoding model output as value</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">input_max_value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implement forward pass of the model.</span>

<span class="sd">    Args:</span>
<span class="sd">        inputs (tf.Tensor): Tensor with image/images batch to process</span>
<span class="sd">        input_max_value (int, optional): Maximal value in input image. Defaults to 1.</span>

<span class="sd">    Returns:</span>
<span class="sd">        [dict[str, dict]]: dict with two keys: &quot;content&quot; and &quot;style&quot;,</span>
<span class="sd">        value of each key contains neasted dict with layer name as key</span>
<span class="sd">        and corespoding model output as value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">content_outputs</span><span class="p">,</span> <span class="n">style_outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_model_outputs</span><span class="p">(</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="n">input_max_value</span>
    <span class="p">)</span>
    <span class="n">content_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content_layers</span><span class="p">,</span> <span class="n">content_outputs</span><span class="p">))</span>
    <span class="n">style_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">style_layers</span><span class="p">,</span> <span class="n">style_outputs</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">content_dict</span><span class="p">,</span> <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="n">style_dict</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.model.StyleContentExtractor.model_layers_names" class="doc doc-heading">
<code class="highlight language-python"><span class="n">model_layers_names</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns a list of vgg19 layer names.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list[str]</code>
          </td>
          <td><p>list[str]</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">model_layers_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a list of vgg19 layer names.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[str]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">layer</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">base_model</span><span class="o">.</span><span class="n">layers</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.19047be9.min.js"></script>
      
    
  </body>
</html>